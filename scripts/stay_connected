function get_var {
    k=$1
    cat /etc/wireless_probe.ini | grep $k | cut -d ' ' -f 3
}

function restart_wireless {
    timeout 5 ifdown wlan0
    ifconfig wlan0 0.0.0.0
    ifconfig wlan0 down
    pkill wpa_supplicant
    rm /var/lib/dhcp/dhclient.wlan0.leases
    nohup ifup wlan0 & 
}

function main {
    iface=$(cat /etc/wireless_interface.conf)
    ping_host=$(get_var ping_host)
    if ping -qc 3 $ping_host >/dev/null; then
        #echo "$ping_host rechable!"
        exit 0
    fi

    echo "$ping_host not rechable!"
    echo "Restarting wireless"
    restart_wireless
}

main
